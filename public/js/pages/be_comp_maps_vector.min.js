/*!
 * oneui - v5.1.0
 * @author pixelcave - https://pixelcave.com
 * Copyright (c) 2021
 */
!function(){
  let i={
    map:"",
    // backgroundColor:"#ffffff",
    regionStyle:{
      initial:{
        // fill:"#5490d2","fill-opacity":1,
        // stroke:"none","stroke-width":0,"stroke-opacity":1
      },
      // hover:{"fill-opacity":.8,cursor:"pointer"}
    }};
    
    One.onLoad(class{
      static initMapWorld(){
        map="world_mill_en",jQuery(".js-vector-map-world").vectorMap(i)
      }
    
      static init(){
        this.initMapWorld()
      }}.init())}();




var map;
let autocomplete;
var geocoder;
var my_location = { lat: -6.97654, lng: 38.87865 };

var markers = [];
function AutoComplete(inputId) {
  autocomplete = new google.maps.places.Autocomplete(
    document.getElementById(inputId),
    {
      types: ["establishment"],
      componentRestrictions: { 'country': ['AU'] },
      fields: ["place_id", "geometry", "name"],
    }
  );
}


function NgataMap(mapProps, imageURi, mapID) {
  map = new google.maps.Map(document.getElementById(mapID), {
    center: my_location,
    zoom: 9,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    // mapTypeId: google.maps.MapTypeId.SATELLITE
  });

  var mapData = [];

  // INSERTING MAP CONTENT
  for (var i = 0; i < mapProps.length; i++) {
    var houseImage = imageURi + "/houses/" + mapProps[i].path
    var content = "<div class='infoWindow'>" +
      "<div class='row'>" +
      "<div class='col-sm-12'>" +
      "<img class='img-w img-fluid' src='" +
      houseImage +
      "'/>" +
      "</div>" +
      "<div class='col-sm-12 text-center' style='padding-top: 5px'>" +
      mapProps[i].dname +
      " - " +
      mapProps[i].wname +
      ", " +
      mapProps[i].cname +
      "</div>" +
      "<div class='col-sm-12 text-center' style='font-size: 16px; padding-top: 5px'>" +
      "<b>TZS " +
      mapProps[i].rent_per_month +
      "</b>/mo" +
      "</div>" +
      "<div class='col-sm-12 text-center' style='padding-top: 5px'>" +
      "<a href='/services/rent/house-details/" +
      mapProps[i].unit_id +
      "/" +
      mapProps[i].price +
      "/" +
      mapProps[i].total_rooms +
      "/" +
      mapProps[i].ward_id +
      "'>More info</a>" +
      "</div>" +
      "</div>" +
      "</div>"
    mapData.push([new google.maps.LatLng(mapProps[i].latitude, mapProps[i].longitude), mapProps[i].unit_type, content]);
  }


  // CREATING MARKER AND INFO WINDOW
  var infowindow = new google.maps.InfoWindow();
  $.each(mapData, function (i, item) {
    var myIcon = imageURi + "/marker/hello1.svg";
    var marker = new google.maps.Marker({
      position: item[0],
      map: map,
      title: item[1],
      icon: myIcon,
      label: {
        text: convertCurrency(mapProps[i].rent_per_month),
        fontSize: "9px",
        fontWeight: "bold",
        color: "#00314a",
        backgroundColor: "red",
      },
    });
    google.maps.event.addListener(marker, 'click', (function (marker) {
      return function () {
        infowindow.setContent(item[2]);
        infowindow.open(map, marker);
      }
    })(marker));
  })
}

function codeAddress() {
  // var address = document.getElementById('address').value;
  geocoder.geocode(
    { address: "Dar es salaam, Tanzania" },
    function (results, status) {
      if (status == "OK") {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location,
        });
      } else {
        alert(
          "Geocode was not successful for the following reason: " +
          status
        );
      }
    }
  );
}


function convertCurrency(currency) {
  if (currency >= 0 && currency < 1000) {
    currency = currency;
  } else if (currency >= 1000 && currency < 1000000) {
    currency /= 1000;
    currency += "K";
  } else if (currency >= 1000000 && currency <= 1000000000) {
    currency /= 1000000;
    currency += "M";
  } else {
    currency /= 1000000000;
    currency += "B";
  }

  return currency;
}

function geoCoords() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition((position) => {
      console.log(position);

      console.log("yes");
    });
  } else {
    console.log("no");
  }
}